# Dockerfile.server
FROM node:25.2.1-slim

# ğŸš€ ç’°å¢ƒè®Šæ•¸ï¼šåœç”¨ npm é€²åº¦é¡¯ç¤ºåŠ é€Ÿå®‰è£
ENV NPM_CONFIG_PROGRESS=false \
    NPM_CONFIG_LOGLEVEL=error \
    NODE_ENV=production

# å®‰è£ FFmpeg, yt-dlp, å’Œ Python (åˆä½µæŒ‡ä»¤æ¸›å°‘å±¤æ•¸)
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    python3-minimal \
    python3-pip \
    && pip install --no-cache-dir yt-dlp --break-system-packages \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \
    && apt-get clean

# è¨­ç½® Node.js æœå‹™å™¨
WORKDIR /app/server

# è¤‡è£½ package.json ä¸¦å®‰è£ä¾è³´ (åˆ†é–‹ COPY åˆ©ç”¨å¿«å–)
COPY server/package.json .
RUN npm install --omit=dev --no-audit --no-fund

# è¤‡è£½æ‡‰ç”¨ç¨‹å¼ç¢¼
COPY server/server.js .
COPY client.html ../client.html

WORKDIR /app

# æš´éœ² WebSocket Port
EXPOSE 8080

# å•Ÿå‹• Node.js ç¨‹å¼
CMD ["node", "server/server.js"]