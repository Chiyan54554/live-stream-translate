# Dockerfile.server
FROM node:25.2.1-slim

# å®‰è£ FFmpeg, yt-dlp, å’Œ Python
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    python3 \
    python3-pip \
    # ğŸŒŸ è§£æ±º PEP 668 éŒ¯èª¤ï¼šåŠ å…¥ --break-system-packages æ——æ¨™
    && pip install yt-dlp --break-system-packages \
    && rm -rf /var/lib/apt/lists/*

# è¨­ç½® Node.js æœå‹™å™¨
WORKDIR /app/server
# è¤‡è£½ package.jsonï¼Œé‹è¡Œ npm install
COPY server/package.json .
RUN npm install

# è¤‡è£½æ‡‰ç”¨ç¨‹å¼ç¢¼å’Œ client.html
COPY server/server.js .
COPY client.html ../client.html

WORKDIR /app

# æš´éœ² WebSocket Port
EXPOSE 8080

# å•Ÿå‹• Node.js ç¨‹å¼
CMD ["node", "server/server.js"]