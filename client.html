<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ’­å¯¦æ™‚ç¿»è­¯ç³»çµ± - å®¢æˆ¶ç«¯</title>
    <!-- æ·»åŠ  Google Fonts æ”¯æ´ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- æ·»åŠ  Font Awesome åœ–ç¤º -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==================================== */
        /* 1. CSS è®Šæ•¸å®šç¾© */
        /* ==================================== */
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --secondary-color: #6366f1;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --background-primary: #ffffff;
            --background-secondary: #f8fafc;
            --background-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }

        /* æ·±è‰²æ¨¡å¼è®Šæ•¸ */
        @media (prefers-color-scheme: dark) {
            :root {
                --background-primary: #1e293b;
                --background-secondary: #0f172a;
                --background-tertiary: #334155;
                --text-primary: #f8fafc;
                --text-secondary: #cbd5e1;
                --text-muted: #64748b;
                --border-color: #475569;
            }
        }

        /* ==================================== */
        /* 2. åŸºç¤å’Œç¾ä»£åŒ–æ¨£å¼ */
        /* ==================================== */
        * {
            box-sizing: border-box;
        }

        body { 
            font-family: 'Inter', 'Noto Sans TC', 'Segoe UI', sans-serif;
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, var(--background-secondary) 0%, var(--background-tertiary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* é ‚éƒ¨å°èˆªæ¬„ */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        h1 { 
            font-size: clamp(1.25rem, 4vw, 2rem);
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ==================================== */
        /* 2. ä½ˆå±€å’Œçµæ§‹ */
        /* ==================================== */
        #container { 
            display: grid;
            grid-template-columns: 2fr 1fr; 
            max-width: 1300px; /* ğŸŒŸ èª¿æ•´ï¼šç•¥å¾®æ”¶çª„æœ€å¤§å¯¬åº¦ */
            margin: 25px auto; /* ğŸŒŸ èª¿æ•´ï¼šå¢åŠ é‚Šè· */
            gap: 25px; /* ğŸŒŸ èª¿æ•´ï¼šå¢åŠ é–“éš™ */
            padding: 0 25px;
        }
        
        @media (max-width: 1000px) {
            #container {
                grid-template-columns: 1fr; 
            }
        }
        
        /* è¦–è¨Šå€ */
        #live-video-section { 
            background-color: #ffffff; /* ğŸŒŸ èª¿æ•´ï¼šç´”ç™½èƒŒæ™¯ */
            border-radius: 12px; /* ğŸŒŸ èª¿æ•´ï¼šæ›´å¤§çš„åœ“è§’ */
            overflow: hidden; 
            aspect-ratio: 16 / 9; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); /* ğŸŒŸ èª¿æ•´ï¼šæŸ”å’Œä¸”æ˜é¡¯çš„é™°å½± */
        }
        #live-video-section iframe {
            width: 100%;
            height: 100%;
            border: none;
            title: "Twitch ç›´æ’­ä¸²æµè¦–çª—"; 
        }
        /* è¦–è¨Šå€ä¸‹çš„æé†’æ–‡å­— */
        #live-video-section p {
            color: #f0f2f5; /* æ·ºè‰²å­—é«”åœ¨æ·±è‰²èƒŒæ™¯ä¸Š */
            padding: 10px;
        }


        /* ç¿»è­¯å€ */
        #translation-section { 
            background-color: #ffffff; /* ğŸŒŸ èª¿æ•´ï¼šç´”ç™½èƒŒæ™¯ */
            padding: 25px; 
            border-radius: 12px; /* ğŸŒŸ èª¿æ•´ï¼šæ›´å¤§çš„åœ“è§’ */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); 
            display: flex;
            flex-direction: column;
        }
        
        h2 { 
            color: #007bff; 
            margin-top: 0; 
            border-bottom: 1px solid #ddd; /* ğŸŒŸ èª¿æ•´ï¼šæ·ºè‰²åˆ†éš”ç·š */
            padding-bottom: 12px; 
            font-size: 1.5em; /* ğŸŒŸ èª¿æ•´ï¼šæ¨™é¡Œå­—é«”å¤§å° */
        }
        
        /* ==================================== */
        /* 3. ç‹€æ…‹æ¨™ç±¤ (æŸ”å’Œé…è‰²) */
        /* ==================================== */
        #status { 
            padding: 12px; 
            margin-bottom: 20px; 
            border-radius: 8px; /* ğŸŒŸ èª¿æ•´ï¼šåœ“è§’é©ä¸­ */
            font-weight: bold; 
            font-size: 0.95em;
        }
        /* æŸ”å’Œçš„ç‹€æ…‹é…è‰² */
        .status-ready { background-color: #e6f7e9; color: #388e3c; border: 1px solid #c8e6c9; } /* ğŸŒŸ å„ªåŒ–ï¼šæŸ”å’Œç¶ è‰² */
        .status-error { background-color: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; } /* ğŸŒŸ å„ªåŒ–ï¼šæŸ”å’Œç´…è‰² */
        .status-connecting { background-color: #fffde7; color: #ffb300; border: 1px solid #fff9c4; } /* ğŸŒŸ å„ªåŒ–ï¼šæŸ”å’Œé»ƒè‰² */

        /* ==================================== */
        /* 4. çµæœåˆ—è¡¨æ’ç‰ˆ */
        /* ==================================== */
        #results { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column-reverse; 
            overflow-y: auto; 
            max-height: 70vh; 
        } 
        .translation-item { 
            margin-bottom: 20px; /* ğŸŒŸ èª¿æ•´ï¼šæ›´å¤§çš„åº•éƒ¨é–“è· */
            padding: 15px; 
            border-left: 4px solid #007bff; /* ğŸŒŸ èª¿æ•´ï¼šä½¿ç”¨ä¸»è—è‰²åˆ†éš”æ¢ */
            background-color: #ffffff; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); /* ğŸŒŸ èª¿æ•´ï¼šæ›´è¼•çš„é™°å½± */
            opacity: 0; 
            animation: fadeIn 0.5s forwards; 
            transition: all 0.3s ease;
        }
        
        /* è½‰éŒ„æ–‡æœ¬ (æ—¥æ–‡) */
        .transcription { 
            color: #777; /* ğŸŒŸ èª¿æ•´ï¼šä¸­ç°è‰²ï¼Œä½œç‚ºè¼”åŠ©è³‡è¨Š */
            font-style: italic; 
            font-size: 0.85em; 
            margin-bottom: 8px; 
            border-bottom: 1px dashed #eee; 
            padding-bottom: 8px;
            line-height: 1.3;
        }
        /* ç¿»è­¯çµæœ (ä¸­æ–‡) */
        .translation { 
            font-weight: 600; /* ğŸŒŸ èª¿æ•´ï¼šä½¿ç”¨è¼ƒç²—çš„å­—é‡ */
            color: #111; /* ğŸŒŸ èª¿æ•´ï¼šæ¥è¿‘ç´”é»‘ï¼Œæœ€é«˜å¯è®€æ€§ */
            font-size: 1.4em; /* ğŸŒŸ èª¿æ•´ï¼šé¡¯è‘—æ”¾å¤§ */
            line-height: 1.5; 
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <h1>ç›´æ’­å¯¦æ™‚ç¿»è­¯ç³»çµ±</h1>

    <div id="container">
        <section id="live-video-section">
            <h2>ç›´æ’­å…§å®¹ (Twitch ç¯„ä¾‹)</h2>
            <iframe
                src="https://player.twitch.tv/?channel=iitifox&parent=YOUR_DOMAIN_OR_IP_ADDRESS&muted=true" 
                allowfullscreen="true"
                allow="autoplay; encrypted-media"
                frameborder="0"
                title="Twitch ç›´æ’­ä¸²æµè¦–çª—">
            </iframe>
            <p><strong>æ³¨æ„ï¼š</strong> éŸ³è¨Šè™•ç†åœ¨ä¼ºæœå™¨ç«¯é€²è¡Œï¼Œè«‹ç¢ºä¿æ‚¨çš„ Node.js ä¼ºæœå™¨æ­£åœ¨ä½¿ç”¨ FFmpeg æŠ“å–æ­¤ç›´æ’­æºã€‚</p>
        </section>

        <section id="translation-section">
            <h2>å¯¦æ™‚ç¿»è­¯çµæœ</h2>
            <div id="status" class="status-connecting">é€£ç·šç‹€æ…‹: æ­£åœ¨å˜—è©¦é€£æ¥ä¼ºæœå™¨...</div>
            <ul id="results">
                <li style="opacity: 1; border-left: 4px solid #ccc; background-color: #f7f7f7; color: #777; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: none;">ç­‰å¾…ç¬¬ä¸€å€‹ç¿»è­¯ç‰‡æ®µ...</li>
            </ul>
        </section>
    </div>

    <script>
        // å˜—è©¦å¾ç•¶å‰ host ç²å– WebSocket URLï¼Œå¦‚æœä¸æ˜¯ http/https å‰‡å›é€€åˆ° localhost
        const getWsUrl = () => {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            if (window.location.protocol === 'file:' || !window.location.host) {
                return 'ws://localhost:8080'; 
            }
            return `${protocol}//${window.location.host.split(':')[0]}:8080`;
        };

        const WSS_URL = getWsUrl();
        const MAX_RESULTS = 5; 
        
        const resultsList = document.getElementById('results');
        const statusDiv = document.getElementById('status');
        let socket;

        function updateStatus(message, statusType = 'connecting') {
            statusDiv.textContent = 'é€£ç·šç‹€æ…‹: ' + message;
            statusDiv.className = 'status-' + statusType;
        }

        function connectWebSocket() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.close();
            }
            updateStatus(`æ­£åœ¨é€£æ¥ä¼ºæœå™¨ (${WSS_URL})...`, 'connecting'); 

            socket = new WebSocket(WSS_URL);

            socket.onopen = function() {
                updateStatus('é€£æ¥æˆåŠŸï¼ç­‰å¾…ä¼ºæœå™¨å‚³è¼¸ç¿»è­¯çµæœ...', 'ready');
                if (resultsList.children[0] && resultsList.children[0].textContent.includes('ç­‰å¾…')) {
                    resultsList.innerHTML = '';
                }
            };

            socket.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data); 
                    
                    if (data.status === 'error') {
                         updateStatus(`ä¼ºæœå™¨éŒ¯èª¤: ${data.message}`, 'error');
                         return;
                    }
                    
                    if (!data.transcription && !data.translation) {
                        return; 
                    }

                    const listItem = document.createElement('li');
                    listItem.className = 'translation-item';
                    
                    // åŸå§‹è½‰éŒ„
                    const transDiv = document.createElement('div');
                    transDiv.className = 'transcription';
                    transDiv.textContent = `(${data.timestamp ?? 'NA'}) [${data.source_lang ?? 'ja'}]: ${data.transcription ?? 'ï¼ˆè½‰éŒ„ä¸­...ï¼‰'}`;
                    
                    // ç¿»è­¯çµæœ
                    const trDiv = document.createElement('div');
                    trDiv.className = 'translation';
                    trDiv.textContent = `[${data.target_lang ?? 'zh-TW'}]: ${data.translation ?? 'ï¼ˆç¿»è­¯ä¸­...ï¼‰'}`;
                    
                    listItem.appendChild(transDiv);
                    listItem.appendChild(trDiv);
                    
                    resultsList.appendChild(listItem); 
                    
                    // æª¢æŸ¥åˆ—è¡¨é•·åº¦ä¸¦ç§»é™¤æœ€èˆŠçš„é …ç›® 
                    while (resultsList.children.length > MAX_RESULTS) {
                        resultsList.removeChild(resultsList.firstChild);
                    }
                    
                } catch (error) {
                    console.error("ç„¡æ³•è§£ææ¥æ”¶åˆ°çš„æ•¸æ“š:", event.data);
                    updateStatus('æ¥æ”¶åˆ°ç„¡æ•ˆæ•¸æ“šï¼Œè«‹æª¢æŸ¥ Python è¼¸å‡ºæ ¼å¼ã€‚', 'error');
                }
            };

            socket.onclose = function(event) {
                updateStatus(`é€£æ¥å·²æ–·é–‹ (${event.code})ï¼Œå˜—è©¦åœ¨ 5 ç§’å¾Œé‡é€£...`, 'error');
                setTimeout(connectWebSocket, 5000); 
            };

            socket.onerror = function(error) {
                console.error('WebSocket éŒ¯èª¤:', error);
            };
        }

        window.onload = connectWebSocket;
    </script>
</body>
</html>